<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>Nuvei Simply Connect 2.0 — 中文演示</title>

  <!-- SimplyConnect.js library -->
  <script src="https://cdn.safecharge.com/safecharge_resources/v1/websdk/simplyConnect_v2.js"></script>

  <style>
    body { font-family: Arial, sans-serif; margin: 2em; }
    input, button { padding: 0.5em; font-size: 1em; margin: 0.5em 0; }
    #simplyConnect { width: 400px; height: 600px; border: 1px solid #d3dce6; margin-top: 1em; }
    pre { background: #f5f5f5; padding: 1em; border-radius: 5px; overflow-x: auto; white-space: pre-wrap; }
    #resultContainer { margin-top: 2em; }
  </style>
</head>
<body>
  <h2>Nuvei Simply Connect 2.0 — 中文演示</h2>

  <p>将从 POST /orders 得到的 <code>sessionId</code> 粘贴到下面：</p>
  <input type="text" id="sessionId" placeholder="请输入 sessionId" size="60" />
  <button id="initBtn">初始化 Simply Connect</button>
  <pre id="initResult"></pre>

  <div id="simplyConnect">
    <p>Simply Connect 支付表单将在此处渲染。</p>
  </div>

  <div id="resultContainer">
    <h3>交易结果：</h3>
    <pre id="transactionResult">尚未发生交易。</pre>
  </div>

  <script>
    const initBtn = document.getElementById("initBtn");
    const initResult = document.getElementById("initResult");
    const transactionResult = document.getElementById("transactionResult");
    const simplyConnectContainer = document.getElementById("simplyConnect");

    initBtn.addEventListener("click", () => {
      const sessionId = document.getElementById("sessionId").value.trim();
      if (!sessionId) {
        initResult.textContent = "❌ 请输入有效的 sessionId。";
        return;
      }

      try {
        window.simplyConnect({
          env: 'int', // "prod" for production
          renderTo: "#simplyConnect",
          sessionId: sessionId,
          eventCallbacks: {
            onResult: function(result) {
              console.log("交易结果:", result);

              if (!result || !result.result || !result.result.status) {
                initResult.textContent = "❌ 支付失败：sessionId 无效或已过期。";
                simplyConnectContainer.style.display = "none";
                transactionResult.textContent = "因 session 问题未进行交易。";
                return;
              }

              simplyConnectContainer.style.display = "none";
              transactionResult.textContent = JSON.stringify(result, null, 2);
              initResult.textContent = `✅ 支付完成，状态：${result.result.status}`;
            },
            onError: function(error) {
              console.error("支付错误:", error);
              initResult.textContent = "❌ 初始化或支付过程出错：" + 
                                        (error?.reason || JSON.stringify(error));
              simplyConnectContainer.style.display = "none";
              transactionResult.textContent = "因错误未进行交易。";
            }
          },
          uiConfig: {
            countryCode: "CN",
            locale: "zh",
            textDirection: "ltr",
            i18n: {
              cc_card: "信用卡",
              lbl_my_methods: "我的支付方式",
              lbl_other_methods: "请选择支付方式",
              lbl_pm_details: "支付详情",
              btn_pay_with: "使用 {method} 支付",
              btn_pay: "支付",
              btn_cancel: "取消",
              msg_success: "支付成功",
              msg_processing: "处理中，请稍候…",
              msg_error: "发生错误，请稍后重试",
              msg_invalid_session: "会话无效或已过期",
              card_number: "卡号",
              card_expiry: "有效期",
              card_cvc: "安全码 (CVC)",
              card_name: "持卡人姓名",
              lbl_saved_cards: "已保存的卡片",
              lbl_save_card: "保存此卡以便下次使用",
              lbl_billing_address: "账单地址",
              lbl_shipping_address: "送货地址"
            },
            error_i18n: {
              decline: "您的支付被拒绝，请联系发卡行。",
              timeoutretry: "连接超时，请重试。",
              donothonor: "发卡行拒绝该交易，请联系银行。"
            },
            payButton: 'textButton'
          }
        });

        initResult.textContent = "✅ Simply Connect 初始化成功。支付表单已显示。";
      } catch (err) {
        initResult.textContent = "❌ 初始化失败：" + (err?.message || JSON.stringify(err));
        simplyConnectContainer.style.display = "none";
        transactionResult.textContent = "因初始化错误未进行交易。";
      }
    });
  </script>
</body>
</html>
