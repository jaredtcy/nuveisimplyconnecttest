<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>Nuvei Simply Connect 2.0 中文测试</title>

  <!-- SimplyConnect.js library -->
  <script src="https://cdn.safecharge.com/safecharge_resources/v1/websdk/simplyConnect_v2.js"></script>

  <style>
    body { font-family: Arial, sans-serif; margin: 2em; }
    input, button { padding: 0.5em; font-size: 1em; margin: 0.5em 0; }
    #simplyConnect { width: 400px; height: 600px; border: 1px solid #d3dce6; margin-top: 1em; }
    pre { background: #f5f5f5; padding: 1em; border-radius: 5px; overflow-x: auto; white-space: pre-wrap; }
    #resultContainer { margin-top: 2em; }
  </style>
</head>
<body>
  <h2>Nuvei Simply Connect 2.0 中文测试页面</h2>

  <p>请输入从 <code>/orders</code> API 获取的 <code>sessionId</code>：</p>
  <input type="text" id="sessionId" placeholder="输入 sessionId" size="60" />
  <button id="initBtn">初始化支付页面</button>
  <pre id="initResult"></pre>

  <!-- Payment form container -->
  <div id="simplyConnect">
    <p>支付表单将在此处显示。</p>
  </div>

  <!-- Transaction result -->
  <div id="resultContainer">
    <h3>交易结果：</h3>
    <pre id="transactionResult">暂无交易。</pre>
  </div>

  <script>
    const initBtn = document.getElementById("initBtn");
    const initResult = document.getElementById("initResult");
    const transactionResult = document.getElementById("transactionResult");
    const simplyConnectContainer = document.getElementById("simplyConnect");

    initBtn.addEventListener("click", () => {
      const sessionId = document.getElementById("sessionId").value.trim();
      if (!sessionId) {
        initResult.textContent = "❌ 请输入有效的 sessionId。";
        return;
      }

      try {
        // Initialize Simply Connect
        const scInstance = window.simplyConnect({
          env: 'int', // use "prod" for production
          renderTo: "#simplyConnect",
          sessionId: sessionId,
          eventCallbacks: {
            onResult: function(result) {
              console.log("交易结果:", result);

              if (!result || !result.result || !result.result.status) {
                initResult.textContent = "❌ 支付失败：无效的 sessionId 或会话已过期。";
                simplyConnectContainer.style.display = "none";
                transactionResult.textContent = "由于无效会话，未完成交易。";
                return;
              }

              simplyConnectContainer.style.display = "none";
              transactionResult.textContent = JSON.stringify(result, null, 2);
              initResult.textContent = `✅ 支付流程完成。状态: ${result.result.status}`;
            },
            onError: function(error) {
              console.error("支付错误:", error);
              initResult.textContent = "❌ 初始化或支付过程中出错: " + 
                                        (error?.reason || JSON.stringify(error));
              simplyConnectContainer.style.display = "none";
              transactionResult.textContent = "由于错误，未完成交易。";
            }
          },
          uiConfig: {
            countryCode: "CN", // China
            locale: "zh",      // Chinese
            textDirection: "ltr"
          },
          i18n: {
            // You can override or customize translations here
            "pay_button": "立即支付",
            "card_number_label": "卡号",
            "expiry_date_label": "到期日期",
            "cvv_label": "安全码",
            "save_card_checkbox": "保存此卡用于下次支付",
            "payment_success_title": "支付成功！",
            "payment_error_title": "支付失败，请重试。"
          }
        });

        initResult.textContent = "✅ Simply Connect 初始化成功。支付表单将在下方显示。";

        // After a short delay, check available payment options
        setTimeout(() => {
          if (window.simplyConnect && window.simplyConnect.getPaymentOptions) {
            window.simplyConnect.getPaymentOptions()
              .then(result => {
                console.log("可用的支付方式:", result);
                alert("✅ 已获取支付方式，请查看浏览器控制台。");
              })
              .catch(err => console.error("获取支付方式时出错:", err));
          } else {
            console.warn("⚠️ getPaymentOptions() 尚不可用。");
          }
        }, 2000);

      } catch (err) {
        initResult.textContent = "❌ 初始化失败: " + err.message;
        simplyConnectContainer.style.display = "none";
        transactionResult.textContent = "初始化错误，无法继续。";
      }
    });
  </script>
</body>
</html>
