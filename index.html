<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>Nuvei Simply Connect 2.0 Demo — 中文测试</title>

  <!-- SimplyConnect.js library -->
  <script src="https://cdn.safecharge.com/safecharge_resources/v1/websdk//simplyConnect_v2.js"></script>

  <style>
    body { font-family: Arial, sans-serif; margin: 2em; }
    input, button { padding: 0.5em; font-size: 1em; margin: 0.5em 0; }
    #simplyConnect { 
      width: 400px; 
      min-height: 700px; 
      border: 1px solid #d3dce6; 
      margin-top: 1em; 
      margin-bottom: 3em; 
      padding: 0.5em;
    }
    pre { background: #f5f5f5; padding: 1em; border-radius: 5px; overflow-x: auto; white-space: pre-wrap; }
    #resultContainer { margin-top: 3em; } /* extra space to prevent overlap */
    .muted { color: #666; font-size: 0.9em; }
  </style>
</head>
<body>
  <h2>Nuvei Simply Connect 2.0 — 中文测试</h2>

  <p class="muted">将从 POST /orders 得到的 <code>sessionId</code> 粘贴到下面并点击“初始化”。</p>
  <input type="text" id="sessionId" placeholder="请输入 sessionId" size="60" />
  <button id="initBtn">初始化 Simply Connect</button>
  <pre id="initResult"></pre>

  <!-- Payment form container -->
  <div id="simplyConnect">
    <p>Simply Connect 支付表单将在此处渲染。</p>
  </div>

  <!-- Transaction result -->
  <div id="resultContainer">
    <h3>交易结果：</h3>
    <pre id="transactionResult">尚未发生交易。</pre>
  </div>

  <script>
    const initBtn = document.getElementById("initBtn");
    const initResult = document.getElementById("initResult");
    const transactionResult = document.getElementById("transactionResult");
    const simplyConnectContainer = document.getElementById("simplyConnect");

    function clearWidget() {
      simplyConnectContainer.innerHTML = "";
      simplyConnectContainer.style.display = "block";
    }

    function initializeSimplyConnect(sessionId) {
      clearWidget();
      window._currentSimplyConnectSessionId = sessionId;

      try {
        window.simplyConnect({
          env: 'int',
          renderTo: "#simplyConnect",
          sessionId: sessionId,
          eventCallbacks: {
            onResult: function(result) {
              console.log("Transaction Result:", result);
              if (!result || !result.result || !result.result.status) {
                initResult.textContent = "❌ 支付失败：sessionId 无效或已过期。";
                simplyConnectContainer.style.display = "none";
                transactionResult.textContent = "因 session 问题未进行交易。";
                return;
              }
              simplyConnectContainer.style.display = "none";
              transactionResult.textContent = JSON.stringify(result, null, 2);
              initResult.textContent = `✅ 支付完成，状态：${result.result.status}`;
            },
            onError: function(error) {
              console.error("Payment Error:", error);
              initResult.textContent = "❌ 初始化或支付过程出错：" + (error?.reason || JSON.stringify(error));
              simplyConnectContainer.style.display = "none";
              transactionResult.textContent = "因错误未进行交易。";
            }
          },
          uiConfig: {
            countryCode: "CN",
            locale: "zh",
            textDirection: "ltr",
            i18n: {
              cc_card: "信用卡",  // section title now translates
              lbl_my_methods: "我的支付方式",
              lbl_other_methods: "请选择支付方式",
              lbl_pm_details: "支付详情",
              delete_payment_token_title: "删除支付令牌",
              btn_pay_with: "使用 {method} 支付",
              msg_success: "支付成功",
              msg_success_text: "您的交易已成功批准。",
              btn_ok: "确定",
              remove_payment_method: "移除支付方式",
              msg_del_confirm_msg: "移除后，此支付方式将不再可用。确定吗？",
              btn_yes_remove_it: "是，移除",
              btn_cancel: "取消",
              btn_remove: "移除",
              msg_declined: "支付被拒绝",
              msg_trx_failed_text: "支付交易失败。您是否希望输入新的支付信息再试一次？",
              msg_payment_already_performed: "支付已完成！",
              btn_refresh: "刷新",
              msg_refresh_invalid_session: "会话已过期，请点击刷新按钮重试。",
              msg_pending: "交易待处理",
              msg_apm_redirect: "未看到 {label} 页面？我们将帮助您返回完成购买。",
              lbl_card_number: "卡号",
              lbl_cvv: "安全码 (CVC)",
              lbl_expiry_date: "有效期",
              lbl_card_holder_name: "持卡人姓名",
              ph_card_number: "1234-5678-1234-5678",
              ph_cvv: "123",
              ph_mm_yy: "MM/YY",
              ph_name_on_card: "张三",
              btn_close: "关闭",
              btn_pay: "支付",
              btn_continue: "继续",
              lbl_save_details: "保存我的信息以便下次使用",
              lbl_always_save_card_details_msg: "继续即表示您同意安全存储卡信息以供下次使用。",
              lbl_always_save_card_details_terms: "有关卡信息使用详情，请查看此处。",
              lbl_always_save_account_credentials_msg: "继续即表示您同意安全存储账户信息以供下次使用。",
              lbl_always_save_account_credentials_terms: "有关账户信息使用详情，请查看此处。",
              err_invalid_cardholder_name: "持卡人姓名无效",
              err_invalid_cardholder_name_characters: "请输入卡片上打印的有效姓名",
              err_invalid_creditcard: "请输入有效的卡号",
              err_invalid_expiration_date: "有效期无效",
              err_invalid_cvv: "安全码无效",
              err_required_field: "此字段为必填项",
              err_ACG_AccountNumber_maxlength: "最多输入17个字符",
              err_ACG_RoutingNumber_exactlength: "必须正好9位数字",
              lbl_show_more: "显示更多",
              lbl_show_less: "显示更少",
              add_upo_success_title: "成功",
              add_upo_decline_title: "拒绝",
              your_account_was_added_msg: "您的 {0} 账户已添加",
              something_went_wrong_msg: "出现错误",
              enter_amount: "输入金额",
              open_amount_label: "最小 {0} - 最大 {1}",
              not_in_range_open_amount: "金额必须在 {0} 与 {1} 之间",
              block_card_msg: "{0} 卡无法处理",
              msg_card_paste_blocked: "无法粘贴卡号",
              lbl_or_pay_with: "或者使用",
              lbl_or_pay_with_card: "或者使用信用卡支付",
              lbl_promo_code: "有优惠码？",
              ph_promo_code: "优惠码",
              err_promo_code: "优惠码不能为空",
              max_cards_msg: "不能保存新的额外卡片",
              max_apm_upos_msg: "不能保存新的额外支付方式",
              one_per_apm_msg: "每个 {0} 账户仅允许一个",
              select_pm_not_available: "{0} 不可用",
              select_upo_not_available: "UPO 不可选择",
              lbl_scan_card_button: "扫描卡片"
            }
          }
        });

        initResult.textContent = "✅ Simply Connect 初始化成功。支付表单已显示。";
      } catch (err) {
        console.error("初始化错误：", err);
        initResult.textContent = "❌ 初始化失败：" + (err?.message || JSON.stringify(err));
        simplyConnectContainer.style.display = "none";
      }
    }

    initBtn.addEventListener("click", () => {
      const sessionId = document.getElementById("sessionId").value.trim();
      if (!sessionId) {
        initResult.textContent = "❌ 请输入有效的 sessionId。";
        return;
      }
      initializeSimplyConnect(sessionId);
    });
  </script>
</body>
</html>
